automation:
  - alias: "System - Startup Services"
    mode: single
    trigger:
      - trigger: homeassistant
        event: start
    action:
      # Set Theme to SmartQasa
      - action: frontend.set_theme
        data:
          name: SmartQasa
      - action: input_button.press
        target:
          entity_id: input_button.refresh_dashboards
        data: {}
      # Run Watchman
      - delay:
          minutes: 2
      - action: watchman.report
        data:
          create_file: true
          send_notification: false
          parse_config: false
          chunk_size: false

  - alias: "System - Adjust Admin PIN when on Startup or PINs change."
    mode: single
    trigger:
      - trigger: homeassistant
        event: start
      - trigger: state
        entity_id:
          - input_text.system_pin
      - trigger: state
        entity_id:
          - input_text.location_pin
    condition: []
    action:
      - action: input_text.set_value
        data:
          value: "{{ states('input_text.system_pin') + states('input_text.location_pin') }}"
        target:
          entity_id: input_text.admin_pin_code

  - alias: "System - Reset Admin Mode on Startup or Timeout"
    mode: single
    trigger:
      - trigger: homeassistant
        event: start
      - trigger: state
        entity_id:
          - input_boolean.admin_mode
        to: "on"
        for:
          hours: 1
    action:
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.admin_mode

  - alias: "System - Toggle Tablet Screens for Light/Dark Mode"
    mode: single
    trigger:
      - trigger: sun
        event: sunrise
        offset: "00:10:00"
      - trigger: sun
        event: sunset
        offset: "00:10:00"
    action:
      - action: switch.turn_off
        data: {}
        target:
          entity_id: >-
            {{ states.switch|selectattr("entity_id", "search",
            "tablet_screen$")|map(attribute="entity_id")|list }}
      - delay:
          seconds: 1
      - action: switch.turn_on
        data: {}
        target:
          entity_id: >-
            {{ states.switch|selectattr("entity_id", "search",
            "tablet_screen$")|map(attribute="entity_id")|list }}

  - alias: "System - Refresh Dashboards on boot, daily, and Lovelace update"
    mode: single
    triggers:
      - trigger: event
        event_type: lovelace_updated
    conditions: []
    actions:
      - action: input_button.press
        target:
          entity_id: input_button.refresh_dashboards
        data: {}

  - alias: "System - Sync Essentials Repository and Restart Home Assistant"
    mode: single
    triggers:
      - trigger: time
        at: "04:00:00"
    conditions: []
    actions:
      - action: shell_command.update_repos
        data: {}
      - delay:
          seconds: 10
      - action: homeassistant.restart
        metadata: {}
        data: {}
